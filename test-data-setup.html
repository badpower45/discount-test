<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± - DeliveryDeal</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            margin-bottom: 10px;
        }
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }
        button:hover {
            background: #1d4ed8;
        }
        button:disabled {
            background: #94a3b8;
            cursor: not-allowed;
        }
        #log {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .info { color: #60a5fa; }
        .warning { color: #fbbf24; }
        .section {
            border-top: 1px solid #e5e7eb;
            margin-top: 20px;
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h1>
        <p class="subtitle">Ø£Ø¯Ø§Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… End-to-End</p>

        <div>
            <button onclick="setupAllTestData()">ğŸš€ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button onclick="clearLog()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>

        <div class="section">
            <h3>Ø¥Ø¹Ø¯Ø§Ø¯ ÙŠØ¯ÙˆÙŠ:</h3>
            <button onclick="addTestRestaurants()">1ï¸âƒ£ Ø¥Ø¶Ø§ÙØ© Ù…Ø·Ø§Ø¹Ù… ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
            <button onclick="addTestDrivers()">2ï¸âƒ£ Ø¥Ø¶Ø§ÙØ© Ø³Ø§Ø¦Ù‚ÙŠÙ†</button>
            <button onclick="addTestDispatcher()">3ï¸âƒ£ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ²Ø¹</button>
            <button onclick="viewCurrentData()">ğŸ‘ï¸ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>
        </div>

        <div id="log"></div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯ Supabase (Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)
        const SUPABASE_URL = 'https://njrippnwixshmuxdweav.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5qcmlwcG53aXhzaG11eGR3ZWF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1OTcwNTIsImV4cCI6MjA3MzE3MzA1Mn0.GIXr4983v1fatUX_iUQuGkJ55zspqadwRR2Ku0M63PE';
        
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('ar-EG');
            logDiv.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„', 'info');
        }

        async function addTestRestaurants() {
            log('ğŸ½ï¸ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'info');
            
            const restaurants = [
                {
                    name: 'Ù…Ø·Ø¹Ù… Ø§Ù„Ø¨ÙŠÙƒ',
                    description: 'Ø£Ø´Ù‡Ø± Ù…Ø·Ø¹Ù… Ù„Ù„Ø¯Ø¬Ø§Ø¬ Ø§Ù„Ù…Ù‚Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©',
                    category: 'restaurant',
                    discount_percentage: 25,
                    image_url: 'https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?w=400',
                    is_active: true
                },
                {
                    name: 'Ù…Ù‚Ù‡Ù‰ Ø³ØªØ§Ø±Ø¨ÙƒØ³',
                    description: 'Ù‚Ù‡ÙˆØ© Ø¹Ø§Ù„Ù…ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©',
                    category: 'cafe',
                    discount_percentage: 15,
                    image_url: 'https://images.unsplash.com/photo-1559305616-3b03921c4593?w=400',
                    is_active: true
                },
                {
                    name: 'Ù…Ø·Ø¹Ù… Ù…Ø§ÙƒØ¯ÙˆÙ†Ø§Ù„Ø¯Ø²',
                    description: 'ÙˆØ¬Ø¨Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¹Ù…Ø§Ø±',
                    category: 'restaurant',
                    discount_percentage: 20,
                    image_url: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=400',
                    is_active: true
                }
            ];

            try {
                const { data, error } = await supabase
                    .from('restaurants')
                    .insert(restaurants)
                    .select();

                if (error) {
                    log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                } else {
                    log(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${data.length} Ù…Ø·Ø§Ø¹Ù… Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                    data.forEach(r => log(`   - ${r.name} (Ø®ØµÙ… ${r.discount_percentage}%)`, 'success'));
                }
            } catch (err) {
                log(`âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${err.message}`, 'error');
            }
        }

        async function addTestDrivers() {
            log('ğŸš— Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠÙŠÙ†...', 'info');
            
            const drivers = [
                {
                    full_name: 'Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯',
                    phone_number: '+966501234567',
                    email: 'ahmed.driver@test.com',
                    vehicle_type: 'motorcycle',
                    status: 'available',
                    rating: 4.8,
                    total_deliveries: 150,
                    city: 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
                    current_location: { lat: 30.0444, lng: 31.2357 }
                },
                {
                    full_name: 'Ø®Ø§Ù„Ø¯ Ø¹Ù„ÙŠ',
                    phone_number: '+966502234567',
                    email: 'khaled.driver@test.com',
                    vehicle_type: 'bicycle',
                    status: 'available',
                    rating: 4.9,
                    total_deliveries: 200,
                    city: 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
                    current_location: { lat: 30.0500, lng: 31.2400 }
                },
                {
                    full_name: 'Ù…Ø­Ù…ÙˆØ¯ Ø­Ø³Ù†',
                    phone_number: '+966503234567',
                    email: 'mahmoud.driver@test.com',
                    vehicle_type: 'car',
                    status: 'available',
                    rating: 4.7,
                    total_deliveries: 180,
                    city: 'Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©',
                    current_location: { lat: 30.0600, lng: 31.2500 }
                }
            ];

            try {
                const { data, error } = await supabase
                    .from('delivery_drivers')
                    .insert(drivers)
                    .select();

                if (error) {
                    log(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
                } else {
                    log(`âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${data.length} Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­!`, 'success');
                    data.forEach(d => log(`   - ${d.full_name} (ØªÙ‚ÙŠÙŠÙ… ${d.rating}/5)`, 'success'));
                }
            } catch (err) {
                log(`âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${err.message}`, 'error');
            }
        }

        async function addTestDispatcher() {
            log('ğŸ“‹ Ø¨Ø¯Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ²Ø¹ ØªØ¬Ø±ÙŠØ¨ÙŠ...', 'info');
            
            try {
                // Ø£ÙˆÙ„Ø§Ù‹ØŒ Ù†Ø­ØªØ§Ø¬ Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ø¯ÙˆÙ„ merchants
                const { data: merchants, error: merchantError } = await supabase
                    .from('merchants')
                    .select('id, name, role')
                    .limit(1);

                if (merchantError) {
                    log(`âš ï¸ ØªØ­Ø°ÙŠØ±: Ø¬Ø¯ÙˆÙ„ merchants Ù‚Ø¯ Ù„Ø§ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ Ø£Ùˆ Ù‚Ø¯ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯ ÙŠØ¯ÙˆÙŠ`, 'warning');
                    log(`   Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ²Ø¹ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¹Ø¨Ø± SQL Ø£Ùˆ Ù„ÙˆØ­Ø© Supabase`, 'warning');
                } else {
                    log(`âœ… Ø¬Ø¯ÙˆÙ„ merchants Ù…ÙˆØ¬ÙˆØ¯ ÙˆÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ${merchants?.length || 0} Ø³Ø¬Ù„Ø§Øª`, 'info');
                    log(`   Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø¯ÙŠØ« role Ù„Ø£Ø­Ø¯ Ø§Ù„ØªØ¬Ø§Ø± Ø¥Ù„Ù‰ 'dispatcher' ÙŠØ¯ÙˆÙŠØ§Ù‹`, 'info');
                }
            } catch (err) {
                log(`âŒ Ø®Ø·Ø£: ${err.message}`, 'error');
            }
        }

        async function viewCurrentData() {
            log('ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©...', 'info');
            
            try {
                // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
                const { data: restaurants, error: restError } = await supabase
                    .from('restaurants')
                    .select('name, discount_percentage')
                    .limit(10);

                if (restError) {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø·Ø§Ø¹Ù…: ${restError.message}`, 'error');
                } else {
                    log(`\nğŸ“ Ø§Ù„Ù…Ø·Ø§Ø¹Ù… (${restaurants?.length || 0}):`, 'info');
                    restaurants?.forEach(r => log(`   - ${r.name} (Ø®ØµÙ… ${r.discount_percentage}%)`, 'info'));
                }

                // Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
                const { data: drivers, error: driverError } = await supabase
                    .from('delivery_drivers')
                    .select('full_name, status, rating')
                    .limit(10);

                if (driverError) {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†: ${driverError.message}`, 'error');
                } else {
                    log(`\nğŸš— Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† (${drivers?.length || 0}):`, 'info');
                    drivers?.forEach(d => log(`   - ${d.full_name} - ${d.status} (${d.rating}/5)`, 'info'));
                }

                // Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                const { data: orders, error: orderError } = await supabase
                    .from('orders')
                    .select('order_number, status, total_price')
                    .limit(5)
                    .order('created_at', { ascending: false });

                if (orderError) {
                    log(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${orderError.message}`, 'error');
                } else {
                    log(`\nğŸ“¦ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª (${orders?.length || 0}):`, 'info');
                    orders?.forEach(o => log(`   - ${o.order_number}: ${o.status} (${o.total_price} Ø¬Ù†ÙŠÙ‡)`, 'info'));
                }

            } catch (err) {
                log(`âŒ Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${err.message}`, 'error');
            }
        }

        async function setupAllTestData() {
            log('ğŸš€ Ø¨Ø¯Ø¡ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©...', 'info');
            log('=====================================\n', 'info');
            
            await addTestRestaurants();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await addTestDrivers();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await addTestDispatcher();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            log('\n=====================================', 'info');
            log('âœ… Ø§ÙƒØªÙ…Ù„ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©!', 'success');
            log('ğŸ”„ Ù‚Ù… Ø¨ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø·Ø§Ø¹Ù…', 'info');
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
        window.addEventListener('load', () => {
            log('Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø£Ø¯Ø§Ø© Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©!', 'success');
            log('Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ø¹Ø¯Ø§Ø¯ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©" Ù„Ù„Ø¨Ø¯Ø¡', 'info');
        });
    </script>
</body>
</html>
