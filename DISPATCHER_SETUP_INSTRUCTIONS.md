# ุชุนูููุงุช ุฅุนุฏุงุฏ ูุธุงู ุงูููุฒุน (Dispatcher System Setup)

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุฅุถุงูุฉ ูุธุงู ููุฒุน ุงุญุชุฑุงูู ูุฅุฏุงุฑุฉ ุชุนููู ุงูุทูุจุงุช ููุณุงุฆููู ูุชูููู ุฃุฏุงุฆูู.

## ุฎุทูุงุช ุงูุชูุนูู

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช Supabase

ูุฌุจ ุชุดุบูู ุงูุณูุฑูุจุช ุงูุชุงูู ูู ูุญุฑุฑ SQL ูู ููุญุฉ ุชุญูู Supabase:

```bash
ุงูุชุญ ููู: dispatcher-system-updates.sql
ุงูุณุฎ ุงููุญุชูู ุจุงููุงูู
ุงูุชุญ Supabase Dashboard > SQL Editor
ุงูุตู ุงูุณูุฑูุจุช ููู ุจุชุดุบููู
```

ุณูููู ูุฐุง ุงูุณูุฑูุจุช ุจู:
- โ ุฅุถุงูุฉ ุฏูุฑ 'dispatcher' ุฅูู ุฌุฏูู merchants
- โ ุฅุถุงูุฉ ุญุงูุฉ 'en_route_to_restaurant' ููุทูุจุงุช
- โ ุฅุถุงูุฉ ุญูู customer_location ูุฌุฏูู orders
- โ ุฅุถุงูุฉ ุญูู auth_user_id ูุฌุฏูู delivery_drivers
- โ ุฅูุดุงุก 6 ูุธุงุฆู RPC ุฌุฏูุฏุฉ ููููุฒุน
- โ ุฅุถุงูุฉ ููุงุฑุณ ููุฃุฏุงุก ุงูุฃูุถู

### 2. ุฅูุดุงุก ูุณุชุฎุฏู ููุฒุน

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุชุ ููููู ุฅูุดุงุก ูุณุชุฎุฏู ููุฒุน:

```sql
-- ูู Supabase SQL Editor
INSERT INTO merchants (name, email, role, auth_user_id)
VALUES (
  'ุงุณู ุงูููุฒุน',
  'dispatcher@example.com',
  'dispatcher',
  NULL -- ุณูุชู ุชุนููู auth_user_id ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู
);
```

### 3. ุงููุตูู ุฅูู ููุญุฉ ุงูููุฒุน

- ุงูุฑุงุจุท: `/dispatcher`
- ูุชุทูุจ ุชุณุฌูู ุฏุฎูู ุจุญุณุงุจ ูู ุฏูุฑ 'dispatcher' ุฃู 'admin'

## ุงูููุฒุงุช ุงููุชุงุญุฉ

### ููุญุฉ ุชุญูู ุงูููุฒุน
1. **ุนุฑุถ ุงูุทูุจุงุช ุงูุฌุงูุฒุฉ**: ุฌููุน ุงูุทูุจุงุช ุจุญุงูุฉ `ready_for_pickup`
2. **ุนุฑุถ ุงูุณุงุฆููู ุงููุชุงุญูู**: ุงูุณุงุฆููู ุจุญุงูุฉ `available`
3. **ุชุนููู ุงูุทูุจุงุช**: ุงุฎุชุฑ ุทูุจ + ุงุฎุชุฑ ุณุงุฆู = ุชุนููู ุชููุงุฆู
4. **ุชูููู ุงูุณุงุฆููู**: ูุธุงู ุชูููู ูู 1 ุฅูู 5 ูุฌูู
5. **ุฅุญุตุงุฆูุงุช ุญูุฉ**: ุทูุจุงุช ุฌุงูุฒุฉุ ุณุงุฆููู ูุชุงุญููุ ุทูุจุงุช ูุดุทุฉ

### ููุญุฉ ุชุญูู ุงูุณุงุฆู ุงููุญุฏุซุฉ
1. **ุฎุฑูุทุฉ ุงูุชูุตูู**: ุนุฑุถ ูููุน ุงููุทุนู ูุงูุนููู
2. **ุญุงูุงุช ุชูุตูููุฉ**:
   - ูู ุทุฑููู ูููุทุนู
   - ุงุณุชููุช ุงูุทูุจ ูู ุงููุทุนู
   - ูู ุทุฑููู ููุนููู
   - ุชู ุงูุชุณููู
3. **ุดุฑูุท ุชูุฏู ูุฑุฆู**: ููุถุญ ุงููุฑุญูุฉ ุงูุญุงููุฉ ูู ุงูุชูุตูู

## ุฏูุฑุฉ ุงูุทูุจ ุงููุงููุฉ

```
ุนููู ูุทูุจ
    โ
ุชุงุฌุฑ ูุคูุฏ ููุญุถูุฑ
    โ
ุชุงุฌุฑ: "ุฌุงูุฒ ููุชูุตูู" โ ready_for_pickup
    โ
ููุฒุน ูุนููู ุณุงุฆู โ en_route_to_restaurant
    โ
ุณุงุฆู: "ุงุณุชููุช ุงูุทูุจ" โ picked_up
    โ
ุณุงุฆู: "ูู ุทุฑููู ููุนููู" โ in_transit
    โ
ุณุงุฆู: "ุชู ุงูุชุณููู" โ delivered
    โ
ููุฒุน ููููู ุงูุณุงุฆู (ุงุฎุชูุงุฑู)
```

## ูุธุงุฆู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

### 1. assign_order_to_driver_by_dispatcher(order_id, driver_id)
- ูุนูู ุทูุจ ูุณุงุฆู ูุญุฏุฏ
- ูุชุญูู ูู ุชููุฑ ุงูุณุงุฆู
- ูุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุฅูู `en_route_to_restaurant`
- ูุญุฏูุซ ุญุงูุฉ ุงูุณุงุฆู ุฅูู `busy`

### 2. rate_driver_by_dispatcher(driver_id, rating)
- ููููู ุฃุฏุงุก ุงูุณุงุฆู (1-5)
- ูุญุณุจ ุงููุชูุณุท ุงูุชุฑุงููู ููุชููููุงุช
- ูุฒูุฏ ุนุฏุงุฏ ุงูุชูุตููุงุช

### 3. fetch_ready_orders_for_dispatcher()
- ูุนุฑุถ ุฌููุน ุงูุทูุจุงุช ุจุญุงูุฉ `ready_for_pickup`
- ูุดูู ูุนูููุงุช ุงููุทุนู ูุงูุนููู

### 4. fetch_available_drivers()
- ูุนุฑุถ ุฌููุน ุงูุณุงุฆููู ุงููุชุงุญูู
- ูุฑุชุจุฉ ุญุณุจ ุงูุชูููู ูุงูุฃุฏุงุก

### 5. fetch_my_driver_orders()
- ููุณุงุฆููู ููุท: ูุนุฑุถ ุทูุจุงุชูู ุงููุฎุตุตุฉ

## ููุงุญุธุงุช ูููุฉ

โ๏ธ **ูุฌุจ ุชุดุบูู ุงูุณูุฑูุจุช ูู Supabase**: ุงูููู `dispatcher-system-updates.sql` ุถุฑูุฑู ูุชูุนูู ุงููุธุงู

โ **ูุธุงู ุขูู**: ุฌููุน ุงููุธุงุฆู ูุญููุฉ ุจุงูุตูุงุญูุงุช ุงูููุงุณุจุฉ

๐ **ููุงูุน ุงูุชุฑุงุถูุฉ**: ูููู ุชุญุฏูุซ ุฅุญุฏุงุซูุงุช ุงููุทุงุนู ูู ุงูููุฏ ุญุณุจ ุงูุญุงุฌุฉ

๐บ๏ธ **ุงูุฎุฑุงุฆุท**: ุชุณุชุฎุฏู OpenStreetMap (ูุฌุงููุฉ ููุง ุชุญุชุงุฌ API key)

## ุงูุงุณุชูุดุงู ูุงูุชุทููุฑ

- ูููู ุฅุถุงูุฉ ุชุชุจุน ูููุน ุงูุณุงุฆู ุงูุญุงูู ูุงุญูุงู ุจุงุณุชุฎุฏุงู `navigator.geolocation`
- ูููู ุฅุถุงูุฉ ุฅุดุนุงุฑุงุช ููุฑูุฉ ุนูุฏ ุชุนููู ุทูุจุงุช ุฌุฏูุฏุฉ
- ูููู ุฅุถุงูุฉ ุชูุงุฑูุฑ ุฃุฏุงุก ุงูุณุงุฆููู
